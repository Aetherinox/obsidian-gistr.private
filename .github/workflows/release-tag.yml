# ---------------------------------------------------------------------------------------
#   @parent     : github workflow
#   @desc       : push release (tag)
#   @author     : Aetherinox
#   @url        : https://github.com/Aetherinox
# ---------------------------------------------------------------------------------------

name: "Release Product"
run-name: "Release Product"

on:
  workflow_dispatch:
    inputs:
      prerelease:
        description: "Release Candidate"
        required: true
        default: false
        type: boolean
      rc_version:
        description: "RC Version"
        required: false
        type: string
        default: 1
env:
    PLUGIN_NAME: gistr
jobs:
    build:
        runs-on: ubuntu-latest
        permissions:
          contents: write
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js
              uses: actions/setup-node@v1
              id: checkout
              with:
                  node-version: "20.x"
                  fetch-depth: 0 # Required due to the way Git works, without it this action won't be able to find any or the correct tags

            # ---------------------------------------------------------------------------------------
            #   Get version from package.json VERSION value
            # ---------------------------------------------------------------------------------------
            - name: Get Package Version
              id: get_package_version
              run: echo "PACKAGE_VERSION=$(cat package.json | jq -r '.version')" >> $GITHUB_ENV

            - name: 'Get Previous tag'
              id: previoustag
              uses: "WyriHaximus/github-action-get-previous-tag@v1"
              with:
                fallback: 1.0.0 # Optional fallback tag to use when no tag can be found
                #workingDirectory: another/path/where/a/git/repo/is/checked/out # Optional alternative

            # ---------------------------------------------------------------------------------------
            #   Build ( Release Candidate )
            # ---------------------------------------------------------------------------------------

            - name: previous tag
              run: |
                echo "Found Previous Tag: ${{ steps.previoustag.outputs.tag }}"


            - name: Build (Release Candidate)
              id: dev
              if: ${{ startsWith( inputs.prerelease, true ) }}
              run: |
                echo "-------------"
                  echo ${{ env.previous_tag }}
                echo "-------------"

